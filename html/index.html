<!doctype html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=1280">
	<title>Crocodile</title>
	<script type="text/javascript">
	if (location.href.indexOf(':8000') != -1) document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
	</script>
	<script src="./js/plugin/jquery-1.9.1.min.js"></script>
	<script src="./js/plugin/jquery-ui-1.12.1.min.js"></script>
	<script src="./js/plugin/jquery.ui.touch-punch.min.js"></script>
	<script src="./js/plugin/jquery.easing.1.3.js"></script>
	<script src="./js/plugin/jquery.transform.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/style.css">
</head>

<body>
	<div class="blgm_wrap">
		<div class="blgm_in animated">
			<div class="score_warp">
				<span class="scr_txt tp01 scoreTeethLeng"></span>
				<span class="scr_txt tp02 scoreTeethTotal"></span>
			</div>
			<div class="tnd_area tndArea">
				<div class="tnd_wrap teethWrap"></div>
			</div>
			<div class="img_cursor imgCursor"></div>
			<div class="anesth_wrap anesthWrap"></div>
		</div>
		<!-- 게임 공통 : S -->
		<div id="ybm_game_2_ready" class="game_ready">
			<div>
				<span>How To Play</span>
				<div class="guide" title="게임방법">
					<p>구멍난 터널을 고치러 가는도중 다리가 끊어졌습니다.</p>
					<p>크레인을 좌우로 움직여 바위를 떨어트려 쌓아 다리 기둥을 만드세요. </p>
					<p>
						<span class="c_red bold">안전선(Safety line)</span>까지 돌기둥을 쌓으면 자동으로 다리가 연결 됩니다.</p>
					<p>바위를 떨어트려 쌓지 못해 물이
						<span class="c_red bold">제한선(20미터)</span>까지 차오르면 다리가
						<br/>무너지고 게임이 종료됩니다.</p>
				</div>
				<ul class='item' title="게임아이템">
					<li>+5점
						<span class="c_red bold">실패시 0.5미터 수면상승</span>
					</li>
					<li>+10점
						<span class="c_red bold">실패시 1미터 수면상승</span>
					</li>
					<li>+15점
						<span class="c_red bold">실패시 1.5미터 수면상승</span>
					</li>
					<li>+20점
						<span class="c_red bold">실패시 2미터 수면상승</span>
					</li>
				</ul>
				<button type="button" id="sound_set" class="on">소리 켬</button>
				<button type="button" id="start_game_2" class="start_game">시작</button>
			</div>
		</div>
		<div id="game_2_next" class="game_over">
			<div>
				<p><em id="game_2_point">100</em><em>포인트</em>가 적립되었습니다.</em>
				</p>
				<button id="game_2_over">다음</button>
			</div>
		</div>
		<!-- 게임 공통 : E -->
		<button id="ios_audio_button" class="">사운드 온오프</button>
	</div>
	<script type="text/javascript">
	//var gamePath = Game.gamePath[Game.gameCode]; //폴더경로 변경값
	var Crocodile = function(obj) {
		this.obj = $.extend(true, {
			teethWrap: '.teethWrap',
			teethEl: '.teethEl',
			teethLength: 12,
			anesth: 3,
			cursor: null,
			level: 2,
			maxGamePoint: 25,
			scoreTeethTotal: '.scoreTeethTotal',
			scoreTeethLeng: '.scoreTeethLeng',
			anesthWrap: '.anesthWrap',
			anesthImg: '.anesthImg',
			imgCursor: '.imgCursor',
		}, obj);
		this.cavityClsName = '.cavity';
		this.count = 0;
		this.loopCount = this.obj.teethLength;
		this.successCount = [];
		this.bool = null;
		this.gamePiont = 0;
		this.gameFinish = false;
		this.sound = {
			bool: true,
			el: '.soundPlayLst',
			onoff: '#ios_audio_button',
			lst: ['.sndLst.tp01', '.sndLst.tp02', '.sndLst.tp03', '.sndLst.tp04'],
		};
		this.mouse = { x: 0, y: 0 };
		this.loop = function() {};
		this.user();
		this.init();
	};
	Crocodile.prototype = {
		init: function() {
			this.set().teethAppend();
			this.set().cursor();
			this.setSound();
			this.loopFun();
			this.bind();
		},
		user: function() {
			var user = navigator.userAgent;
			var userArray = [
				['mob', user.indexOf('Mobile') != -1],
				['android', user.indexOf('Android') != -1],
				['iphone', user.indexOf('iPhone') != -1]
			];
			for (var i = 0; i < userArray.length; i++) {
				if (userArray[i][1]) {
					$('html').addClass(userArray[i][0]);
					this.mobile = true;
				}
			}
		},
		setSound: function() {
			var _this = this;
			var button = '';
			$(this.sound.onoff).off().on('click', function() {
				$(this).toggleClass('off');
				if ($(this).is('.off')) {
					_this.sound.bool = false;
				} else {
					_this.sound.bool = true;
				}
			});
			for (var i = 0; i < this.sound.lst.length; i++) {
				$(this.sound.lst[i]).attr('data-sudfile', i);
				button += '<button data-sudbutton="' + i + '" class="hidden" type="button">오디오버튼</button>';
			}
			$(this.sound.el).append(button);
		},
		getSound: function(el) {
			if (this.sound.bool) {
				var $el = $(el);
				var $data = $el.data('sudfile');
				$el[0].muted = false;
				$('[data-sudbutton="' + $data + '"]').off().on('click', function() {
					$('[data-sudfile="' + $data + '"]')[0].play();
				}).click();
			}
		},
		set: function() {
			var _this = this;
			this.scoreAnesthFun().score();
			this.scoreAnesthFun().anesth();
			return {
				teethAppend: function() {
					var html = '';
					var cls = '';
					for (var i = 0; i < _this.obj.teethLength; i++) {
						if (i == 0) {
							cls = _this.clsFormat(_this.obj.teethEl) + ' ' + _this.clsFormat(_this.cavityClsName);
						} else {
							cls = _this.clsFormat(_this.obj.teethEl);
						}
						html += '<a href="javascript: ;" class="' + cls + ' tp' + i + '" data-count="' + i + '"></a>';
					}
					$(_this.obj.teethWrap).append(html);
				},
				cursor: function() {
					//this.obj.imgCurso
					$('.tndArea').on({
						'mousemove': function() {
							_this.mouse.x = event.pageX + 75;
							_this.mouse.y = event.pageY;
							$(_this.obj.imgCursor).css({
								'left': _this.mouse.x - $('.tndArea')[0].offsetLeft,
								'top': _this.mouse.y - $('.tndArea')[0].offsetTop + 207,
							});
						}
					})
				},
			};
		},
		loopFun: function() {
			var _this = this;
			var cnt = 1;
			_this.loop = setInterval(function() {
				if (_this.count >= (_this.loopCount - 1) || _this.count < 0) {
					cnt = cnt * -1;
				} else if (_this.count == 0) {
					cnt = 1;
				}
				_this.count += cnt;
				$(_this.obj.teethEl).removeClass(_this.clsFormat(_this.cavityClsName));
				$(_this.obj.teethEl + '[data-count=' + _this.count + ']').addClass(_this.clsFormat(_this.cavityClsName));
			}, 2000 / this.obj.level);
		},
		bind: function() {
			var _this = this;
			$(_this.obj.teethEl).on({
				'click': function() {
					event.preventDefault();
					if ($(this).is(_this.cavityClsName)) {
						$(this).addClass('active');
						_this.bool = true;
						_this.act($(this));
					} else {
						_this.bool = false;
						_this.act($(this));
					}
				},
			});
		},
		act: function($this) {
			var _this = this;
			var $data = $this.data('count');
			if (_this.bool) {
				this.successCount.push($data);
				var cnt = 0;
				$(this.obj.teethEl).each(function() {
					if (!$(this).is('.active')) {
						$(this).attr('data-count', cnt);
						cnt++;
					} else {
						$(this).removeAttr('data-count');
					}
				});
				if ($data == 0) {
					this.count = 0;
				} else {
					this.count--;
				}
				if (this.successCount.length == this.obj.teethLength) {
					this.gameFinishFun(this.bool);
				}
				this.loopCount--;
				this.scoreAnesthFun().score();
			} else {
				clearInterval(this.loop);
				this.obj.anesth--;
				$(this.obj.anesthImg + '[data-anesth="' + this.obj.anesth + '"]').addClass('null');
				if (!this.obj.anesth) {
					this.gameFinishFun(this.bool);
					return;
				}
				if (!this.gameFinish) {
					_this.loopFun();
				}
			}

		},
		scoreAnesthFun: function() {
			var _this = this;
			return {
				score: function() {
					$(_this.obj.scoreTeethTotal).text(_this.obj.teethLength);
					$(_this.obj.scoreTeethLeng).text($(_this.obj.teethEl + '.active').length);
				},
				anesth: function() {
					var $el = $(_this.obj.anesthWrap);
					var html = '';
					if (!$el.children().length) {
						for (var i = 0; i < _this.obj.anesth; i++) {
							html += '<span class="img_anesth anesthImg" data-anesth="' + i + '"></span>';
						}
						$el.html(html);
					}
				},
			};

		},
		gameFinishFun: function(bool) {
			if (bool) {
				alert('성공');
			} else {
				alert('실패');
			}
			this.gameFinish = true;
			this.gamePiontFun();
		},
		gamePiontFun: function() {
			this.gamePoint = Math.round((this.successCount.length / this.obj.teethLength) * this.obj.maxGamePoint);
		},
		clsFormat: function(cls) {
			return cls.replace('.', '');
		},
	};


	var Game = {};
	var crocodile = null;
	$('#start_game_2').off().on('click', function() {
		$('#ybm_game_2_ready').hide();
		crocodile = new Crocodile({});
	}).click();
	//끝났을때
	//cny 마지막 Next버튼 클릭시 LMS에 값 저장하기
	$('#game_2_over').off().click(function() {
		Game.saved = callback(Game.gameCode, Game.schedIndex, Game.seqNo, Game.point);
		if (Game.saved) {
			Game.ending();
		} else {
			if (confirm("통신상태가 원할하지 못해 게임점수가 저장되지 않았습니다.\n그래도 진행하시겠습니까?")) Game.ending();
		}
	});
	</script>
</body>

</html>